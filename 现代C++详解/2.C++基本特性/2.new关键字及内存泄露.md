## new关键字
new关键字是C++用来**动态分配内存**的主要方式
- 内存很宝贵，动态分配内存可以根据需要去申请内存，用完后就还回去，让需要的程序用
- 它在创建数组或对象时，会返回这个对象的指针
- new开辟的空间在堆上，而一般声明的变量存放在栈上
- 通常在局部函数中new出的一段新空间在局部函数调用结束后仍然能够使用，可以用来向主函数传递参数
- new出来的是一段空间的首地址，所以一般需要用指针来存放这段地址
- new可以直接分配单个变量的内存，也可以分配数组

在分配单个对象的内存时
- 当对象是普通变量时，可以分配对应的内存
- 当对象是类对象时，会调用构造函数，如果没有对应的构造函数，就会报错。
```
#include<iostream>
using namespace std;

int main()
{
	int* pi = new int(100);  // 给普通对象分配内存时同时初始化，也可以单独赋值
	cout << *pi << endl;     // print 100
	delete pi;               // new出来的对象必须delete释放，否则会出现内存泄漏
	return 0;
}
```
在分配数组对象内存时：
- 对于普通变量：可以使用“（）”将所有对象全部初始化为0
- 对于类对象，有没有“（）”都一样，均使用默认构造函数，如果没有默认构造函数就会报错。
```
#include<iostream>
using namespace std;

int main()
{
	int* pi = new int[100]();  // 不能在括号里赋初值（字符串也不行）
	// string* pstring = new string("hello");  //没有括号或者不初始化就默认初始化为空字符串
	cout << pi[20] << endl;    // print 0
	delete[] pi;               // 必须加上[],不然会内存泄漏
	return 0;
}
```
## 内存泄露介绍
内存泄露是经常出现的常见bug，会导致堆内存的逐渐被占用，最终内存用完程序崩溃。可能一开始运行的好好的，突然就出现了莫名其妙的错误
- 可以用vld工具帮助检测
  - 使用的话需要包含头文件目录（include）、静态库（lib）、动态库（dll）
  - 使用方法详见视频
- Part4的智能指针可以非常好的避免内存泄露的问题
- Part9的异常处理部分可以恰当的处理程序出现的异常，让程序有错误就立马处理 / 直接终止进程 / 忽略